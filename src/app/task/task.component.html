<div class="container mx-auto">
  <div class="mt-50">
    <div>
      <h1 class="text-3xl text-white bg-sky-500 p-3 mb-6">Tasks</h1>
    </div>

    @if (view === 'table') {
    <button
      class="bg-emerald-400 hover:bg-emerald-500 text-white py-2 px-4 float-end text-lg rounded-md cursor-pointer mb-3 transition-all"
      (click)="addTask()"
    >
      Add Task
    </button>

    <table class="table-auto w-full">
      <thead class="bg-gray-100">
        <tr>
          <th class="text-left px-4 py-2">#</th>
          <th class="text-left px-4 py-2 text-lg">Title</th>
          <th class="text-left px-4 py-2 text-lg">Description</th>
          <th class="text-left px-4 py-2 text-lg">Status</th>
          <th class="text-left px-4 py-2 text-lg">Due date</th>
          <th class="text-left px-4 py-2 text-lg">Actions</th>
        </tr>
      </thead>
      <tbody>
        @for(task of tasks; track task.id; let i = $index ){
        <tr class="border-b border-gray-200">
          <td class="px-4 py-2">{{ i + 1 }}</td>
          <td class="px-4 py-2">{{ task.title }}</td>
          <td class="px-4 py-2">{{ task.description }}</td>
          <td class="px-4 py-2">
            <span
              class="py-1 px-2 rounded-xl"
              [class]="{'bg-sky-300': task.status == 'CREATED',
            'bg-amber-300': task.status == 'IN_PROGRESS',
            'bg-green-300': task.status == 'COMPLETED',
            'bg-red-300': task.status == 'REJECTED',

            }"
            >
              @if(task.status == "CREATED"){Created} @if(task.status ==
              "IN_PROGRESS"){In progress} @if(task.status ==
              "COMPLETED"){Completed} @if(task.status == "REJECTED"){Rejected}
            </span>
          </td>
          <td class="px-4 py-2">{{ task.dueDateTime | date }}</td>
          <td class="px-4 py-2">
            <a
              class="text-sky-500 hover:underline cursor-pointer mr-4"
              (click)="edit(task)"
              >edit</a
            >
            <a class="text-red-400 hover:underline cursor-pointer
            " (click)="delete(task)">delete</a>
          </td>
        </tr>
        }
      </tbody>
    </table>
    } @if(view === 'form'){

    <div>
      <h3 class="text-xl font-semibold mb-6">Enter task details</h3>
      <form
        [formGroup]="taskForm"
        (ngSubmit)="submit()"
        class="flex flex-col gap-4"
      >
        <div>
          <label for="" class="block mb-2 text-lg">Title <span class="text-red-400">*</span></label>
          <input
            type="text"
            name=""
            id=""
            formControlName="title"
            class="w-1/2 px-4 py-2 rounded-md border-2 border-black focus:ring-3 focus:ring-black-400"
          />
          @if(title?.invalid && title?.touched){
          <p class="py-2 text-red-400 text-md">Title required</p>
          }
        </div>

        <div>
          <label for="" class="block mb-2 text-lg">Description</label>
          <textarea
            type="text"
            name=""
            id=""
            formControlName="description"
            class="w-1/2 px-4 py-2 rounded-md border-2 border-black focus:ring-3 focus:ring-black-400"
          ></textarea>
        </div>

        <div>
          <label for="" class="block mb-2 text-lg">Status <span class="text-red-400">*</span></label>
          <select
            name=""
            id=""
            formControlName="status"
            class="w-1/2 px-4 py-2 rounded-md border-2 border-black focus:ring-3 focus:ring-black-400"
          >
            <option value=""></option>
            <option value="CREATED">Created</option>
            <option value="IN_PROGRESS">In progress</option>
            <option value="COMPLETED">Completed</option>
            <option value="REJECTED">Rejected</option>
          </select>
          @if(status?.invalid && status?.touched){
          <p class="py-2 text-red-400 text-md">Status required</p>
          }
        </div>

        <div>
          <label for="" class="block mb-2 text-lg">Due date <span class="text-red-400">*</span></label>
          <input
            type="date"
            name=""
            id=""
            formControlName="dueDateTime"
            class="w-1/2 px-4 py-2 rounded-lg border-2 border-black focus:ring-3 focus:ring-black-400"
          />
          @if(dueDateTime?.invalid && dueDateTime?.touched){
          <p class="py-2 text-red-400 text-md">Due date required</p>
          }
        </div>

        <div class="flex gap-2 items-center justify-between">
          <button
            [disabled]="isSubmitting"
            type="submit"
            class="px-4 py-2 rounded-md bg-emerald-400 border-2 text-white border-emerald-400 hover:bg-emerald-500 text-lg cursor-pointer hover:opacity-90 transition-all"
          >
            @if(isSubmitting){ saving... }@else{ Save }
          </button>
          @if(callBackMessage){
          <p
            class="text-lg"
            [class]="{ 'text-red-400': isError, 'text-teal-300': isSent }"
          >
            {{ callBackMessage }}
          </p>
          }
          <button
            class="border-gray-500 border-2 hover:bg-gray-300 text-gray-500 hover:text-white py-2 px-4 text-lg rounded-md cursor-pointer transition-all"
            (click)="cancel()"
          >
            Cancel
          </button>
        </div>
      </form>
    </div>
    } @if(this.isSent){
    <div class="container mx-auto m-10 flex items-end justify-center">
      <div class="flex flex-col gap-4 border-2 rounded-md w-1/2 p-10">
        <h1 class="text-3xl">{{ callBackMessage }}</h1>
        <a
          class="text-emerald-500 hover:underline cursor-pointer"
          (click)="back()"
          >Back</a
        >
      </div>
    </div>
    }

    @if(isDeleting){
    <div class="container mx-auto m-10 flex items-end justify-center">
      <div class="flex flex-col gap-4 border-2 rounded-md w-1/2 p-10">
        <h1 class="text-3xl">Are you sure you want to delete Task {{taskToDelete}}?</h1>
        <div class="flex justify-between gap-2">
           <a
          class="text-red-400 hover:underline cursor-pointer"
          (click)="deleteBack()"
          >No</a
        >
         <a
          class="text-sky-400 hover:underline cursor-pointer"
          (click)="deleteTask()"
          >Yes</a
        >
        </div>
      </div>
    </div>
    }
  </div>
</div>
